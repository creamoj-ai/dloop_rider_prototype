# Deployment Checklist

**Project**: Dloop WhatsApp Bot MVP | **Date**: 2026-02-26

## Pre-Deployment ✅

- [ ] Supabase project created and accessible
- [ ] Meta Business Account set up
- [ ] OpenAI API key obtained
- [ ] Node.js 18+ installed
- [ ] Git repository cloned locally
- [ ] All environment variables documented

## Environment Setup ✅

- [ ] `DB_URL` configured (postgresql://...)
- [ ] `DB_ANON_KEY` configured
- [ ] `DB_ROLE_KEY` configured
- [ ] `OPENAI_API_KEY` configured
- [ ] Secrets added to Supabase project
- [ ] All secrets verified readable by functions

## Database Schema ✅

- [ ] Run `sql/ESEGUI_QUESTO.sql` migration
- [ ] Verify `whatsapp_conversations` table exists
- [ ] Verify `whatsapp_messages` table exists
- [ ] Verify `whatsapp_order_relays` table exists
- [ ] Check RLS policies applied
- [ ] Verify indexes created

## Function Deployment ✅

- [ ] `whatsapp-webhook` deployed
- [ ] `whatsapp-simulate` deployed
- [ ] `whatsapp-webhook-v2` deployed
- [ ] `whatsapp-test-webhook` deployed
- [ ] `whatsapp-notify` deployed
- [ ] `setup-whatsapp-schema` deployed (if needed)

## Function Configuration ✅

- [ ] All functions have required secrets
- [ ] All functions have correct imports
- [ ] Edge function timeouts set to 60s
- [ ] CORS headers configured
- [ ] No hardcoded credentials in code

## Meta Business Setup ✅

- [ ] WhatsApp API enabled
- [ ] Phone number ID obtained: `_____________`
- [ ] Access token obtained: `_____________`
- [ ] Webhook URL configured: `https://<project>.supabase.co/functions/v1/whatsapp-webhook`
- [ ] Verify token set to: `dloop_wa_verify_2026`
- [ ] Webhook events subscribed: `messages`
- [ ] Privacy Policy URL added
- [ ] Terms of Service URL added

## Testing ✅

**Unit Tests**
- [ ] `node diagnose-bot.js` passes
- [ ] Database connectivity: OK
- [ ] Webhook endpoint reachable: OK

**Integration Tests**
- [ ] `node test-webhook-directly.js` returns 200
- [ ] Message appears in database
- [ ] Response generated by ChatGPT

**Live Tests**
- [ ] Send test message from real WhatsApp number
- [ ] Bot responds within 5 seconds
- [ ] Response is relevant and in Italian
- [ ] Message stored in database with correct status

## Post-Deployment ✅

- [ ] Bot accessible at: `+39 328 1854639`
- [ ] Webhook logs show incoming messages
- [ ] No errors in function logs
- [ ] Database queries perform well
- [ ] All dealer contacts properly configured
- [ ] OpenAI token usage within budget

## Documentation ✅

- [ ] Deployment guide reviewed
- [ ] API documentation complete
- [ ] Troubleshooting guide available
- [ ] Runbooks created for common issues
- [ ] Team trained on monitoring

## Production Readiness ✅

- [ ] Code reviewed and approved
- [ ] Security audit completed
- [ ] Rate limits configured
- [ ] Backup procedures documented
- [ ] Rollback procedure tested
- [ ] Monitoring alerts set up
- [ ] Incident response plan documented

## Sign-Off

- [ ] Deployment Engineer: _____________ Date: _______
- [ ] Product Manager: _____________ Date: _______
- [ ] Operations: _____________ Date: _______

---

**Status**: ⬜ Ready for Deployment | ⏳ In Progress | ✅ Deployed

Current Status: **In Progress** (as of 2026-02-26)

**Next Actions**:
1. Complete testing phase
2. Verify Meta webhook configuration
3. Run full diagnostics
4. Sign off checklist
5. Deploy to production
